cassandra
to enable UDFS => enable_user_defined_functions must be set true in cassandra.yaml file

CREATE KEYSPACE dishes_db WITH replication = {
  'class': 'SimpleStrategy', 
  'replication_factor': 1
};

USE dishes_db;

-- DROP TABLE IF EXISTS dishes;
-- CREATE TABLE dishes (
--   citystate TEXT,
--   dish TEXT,
--   avgrating DOUBLE,
--   businessId TEXT,
--   numreviews INT,
--   totalscore INT,
--   promotext TEXT,
--   promoscore INT,
--   PRIMARY KEY ((dish, citystate),businessid)
-- );


DROP TABLE IF EXISTS dishes;
CREATE TABLE dishes (
  citystate TEXT,
  dish TEXT,
  avgrating DOUBLE,
  businessId TEXT,
  numreviews INT,
  totalscore INT,
  promotext TEXT,
  promoscore INT,
  PRIMARY KEY (citystate, dish)
);
CREATE INDEX ON dishes (businessid);


DROP TABLE IF EXISTS businesses;
CREATE TABLE businesses (
  businessId TEXT,
  name TEXT,
  full_address TEXT,
  citystate TEXT,
  city TEXT,
  state TEXT,
  stars DOUBLE,
  reviewcount INT,
  PRIMARY KEY (citystate,businessid)
);

/*
CREATE OR REPLACE FUNCTION incrementBy1 (num int) CALLED ON NULL INPUT RETURNS int LANGUAGE java AS 'return ((num == null) ? 0 : num) + 1;';

CREATE OR REPLACE FUNCTION getAverageScore (totalscore double, numreviews int) CALLED ON NULL INPUT RETURNS double LANGUAGE java AS 'return totalscore / numreviews;';

select numreviews, incrementBy1(numreviews), getAverageScore(totalscore,numreviews) from dishes;


UPDATE dishes SET avgrating = getAverageScore(totalscore,increment(numreviews)), numreviews = increment(numreviews), totalscore = (totalscore + 5) WHERE dish = 'udon' and restaurantid = 'abc'

  promo = "this is awesome udon",
  promorating INT,

UPDATE dishes SET avgrating = 5, numreviews = 100, totalscore = 500 WHERE dish = 'udon' and restaurantid = 'abc';



//create table for business with business id, full address, city, name, stars
//how can I filter on city?  maybe use composite key (city-businessID)? 


EMR installation (switch environment to java 1.8)
[
    {
        "Classification": "hadoop-env", 
        "Configurations": [
            {
                "Classification": "export", 
                "Configurations": [], 
                "Properties": {
                    "JAVA_HOME": "/usr/lib/jvm/java-1.8.0"
                }
            }
        ], 
        "Properties": {}
    }, 
    {
        "Classification": "spark-env", 
        "Configurations": [
            {
                "Classification": "export", 
                "Configurations": [], 
                "Properties": {
                    "JAVA_HOME": "/usr/lib/jvm/java-1.8.0"
                }
            }
        ], 
        "Properties": {}
    }
]

to switch to 1.8
sudo /usr/sbin/alternatives --config java

install cassandra copy tz file there and unzip
open ports on main cluster
7199 - JMX (was 8080 pre Cassandra 0.8.xx)
7000 - Internode communication (not used if TLS enabled)
7001 - TLS Internode communication (used if TLS enabled)
9160 - Thrift client API
9042 - CQL native transport port
*/


